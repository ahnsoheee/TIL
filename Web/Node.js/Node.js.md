## Node.js

- 자바스크립트를 서버에서 구현하기 위한 런타임 환경
- **싱글 스레드로 동작하며 비동기식 입출력을 사용**한다.
     -> 싱글스레드 논블로킹 모델 ; 비동기 I/O 작업을 통해 요청들은 서로 블로킹하지 않음

### 구성

![노드](https://user-images.githubusercontent.com/61968474/130497630-5e50dc3c-c17b-4528-aa00-c48a18303464.PNG)

1. V8
    - 자바스크립트 엔진
    - 메모리 힙과 콜 스택으로 구성
    - 메모리 힙 : 메모리 할당이 일어나는 곳
    - 콜 스택 : 코드 실행에 따라 호출 스택이 쌓이는 곳
    - 자바스크립트 엔진은 콜스택에 쌓인 실행 컨텍스트에 따라 위에서부터 차례로 실행되기 때문에 비동기 처리를 할 수 없다. 따라서 비동기 처리가 필요한 경우 libuv 라이브러리에서 제공하는 비동기 처리를 하게 된다.

2. Libuv library 
    - 비동기 작업을 처리하는 라이브러리
    - 이벤트 루프를 제공한다.
    - 리버브의 스레드 풀은 멀티 스레드 방식, JS를 실행하는 메인 스레드(이벤트 루프)는 단 하나이기 때문에 Node.js를 싱글 스레드라고 한다.



### 과정 및 특징

![node](https://user-images.githubusercontent.com/61968474/130496872-2921718e-bac1-4a2c-a5f2-a9069d4f5685.PNG)

- 입력이 발생하면 스레드 풀에 작업을 전달하고, 입출력이 완료되면 이벤트 큐에 콜백 함수를 쌓는다.
- 이벤트 루프(**메인 스레드**)는 항상 돌고 있다가 V8 엔진의 호출 스택이 비워지면 이벤트 큐에서 작업을 처리한다.
- 작업이 완료될 때까지 기다리지 않고 다른 작업을 먼저 처리하는 non-blocking 방식으로 처리한다.
- 노드는 이벤트 기반으로 이벤트 리스너에 등록해 둔 콜백함수를 실행하는 방식으로 동작한다. 여기서 콜백함수를 관리하는 것이 이벤트 루프이고, 이벤트 루프는 이벤트 발생 시 호출되는 콜백함수를 태스크 큐에 전달한다. 
- 태스크 큐에 담긴 콜백함수를 콜스택에 넘겨준다.
    태스크 큐 : Web API에서 비동기 작업이 실행된 후 호출되는 콜백함수들이 기다리는 공간
- 싱글 스레드 기반이기 때문에 PM2를 활용해 멀티 스레드처럼 사용할 수 있다.

### 런타임 환경에서 비동기 처리 ??
- 호출 스택에 쌓인 후 자바스크립트 엔진은 비동기 작업을 Web API에게 위임한다.
- Web API는 해당 작업을 수행하고, 콜백함수를 이벤트 루프를 통해 태스크 큐에 전달한다.
- 이벤트 루프는 콜스택에 쌓여있는 함수가 없을 때, 태스크 큐에서 대기하던 콜백함수를 콜스택으로 넘긴다.
- 콜스택에 쌓인 함수가 실행되고, 콜스택에서 제거된다.
- 이러한 방식으로 비동기 처리가 진행된다.


[참고](https://medium.com/@gwakhyoeun/%EC%99%9C-node-js%EB%8A%94-single-thread-%EC%9D%B8%EA%B0%80-bb68434027a3)