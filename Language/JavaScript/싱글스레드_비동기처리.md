## 싱글스레드, 비동기

<img width="762" alt="스크린샷 2022-02-13 오후 2 04 48" src="https://user-images.githubusercontent.com/61968474/153739520-275fd7c3-56a8-4835-a74b-62b89c951bc9.png">

- 호출 스택에 쌓인 후 자바스크립트 엔진은 비동기 작업을 Web API에게 위임한다.
- Web API는 해당 작업을 수행하고, 이벤트 루프를 통해 콜백함수를 태스크 큐에 전달한다.
- 이벤트 루프는 콜스택이 비워지면, 태스크 큐에서 대기하던 콜백함수를 콜스택으로 넘긴다.
- 콜스택에 쌓인 함수가 실행되고, 콜스택에서 제거된다.
- 이러한 방식으로 비동기 처리가 진행된다.


### JS가 싱글스레드인 이유
- 자바스크립트가 **하나의 메인 스레드(이벤트 루프)와 하나의 콜 스택**을 통해 처리되기 때문이다.
- 멀티스레드로 실행된다면 웹페이지에서 발생하는 동시성 문제를 해결해야한다.
- 하나의 스레드(콜 스택)에서 돌아가는데 이 시간 차가 너무 작기 때문에 동시에 돌아간다고 착각할 수 있다.

### 비동기 관련 개념

#### AJAX (Asynchronous JavaScript and XML)
- 비동기 통신을 위한 자바스크립트 라이브러리
- 클라이언트와 서버 간에 데이터를 주고 받는 기술
- 빠르게 동작하는 동적인 웹 페이지를 만들기 위한 기법
- 웹 페이지 전체를 리로드하지 않고 일부분만 갱신할 수 있다. (비동기식)
- XMLHttpRequest 객체를 생성해서 서버에 HTTP 요청을 보내고 JSON이나 XML 형태로 필요한 데이터만 받아 갱신한다. -> 자원과 시간을 아낌
- 단점 
    - 연속으로 데이터 요청 시 서버 부하가 증가할 수 있다.
    - 요청이 완료되지 않은 상태에서 사용자의 페이지 이탈 시 오작동할 우려가 있다.


#### Promise
- 자바스크립트에서 비동기 처리에 사용되는 객체
- 비동기 처리가 완료되지 않은 Pending(대기) 상태
- 비동기 처리가 완료되어 결과 값을 반환해 준 Fullfilled(이행) 상태
- 비동기 처리가 실패하거나 오류난 Rejected(실패) 상태
- resolve와 reject로 접근 가능하다.
- 미래 시점의 데이터를 위한 것이지만, 무언가의 promise를 갖고 있기만 하면 then을 불러 사용할 수 있다.
- 비동기를 강제 실행하는 것이다.
- 콜백이 예측 가능한 패턴으로 사용을 도와준다.
- 콜백 함수 안에서 생성된 프로미스 객체를 활용하여 콜백함수의 성공, 실패, 오류 경우에 따라 처리가 가능하다.
- 콜백패턴에 비해 코드 가독성이 좋고 반환된 값을 사용하기 편리하다.
- 순서
    - 1. Promise 객체를 반환
    - 2. Promise 객체의 인자에는 resolve function과 reject function 존재
    - 3. Promise 객체에는 then 이라는 method 존재
    - 4. then은 function을 인자로 받는다.
    - 5. then에서 넘겨진 function은 promise의 resolve 에서 실행

#### Event Emitter

- node.js의 이벤트 기반의 비동기 방식 서버 프레임워크.
- on() : 이벤트를 연결하는 함수 → 이벤트가 발생되면 다음 함수를 실행
- emit() : 이벤트를 발생시키는 함수

#### Callback
- 자바스크립트 비동기 통신의 단접을 보완하기 위한 개념
- 인자로 받은 함수를 다시 호출하는 기능
- 연속적으로 사용하면 유지보수가 어려워진다.

#### Async & Await 
- 비동기 방식 패턴 중 가장 최근에 나온 문법
- Promise를 쉽게 사용하도록 지원하는 ES8 문법
- promise에서 .then()을 쓰는 것과 동일 (차이 : 콜백 함수를 요구하지 않는다.)
- 기존에는 콜백을 통해 실행 순서를 보장받았지만, async & await의 등장으로 callback과 promise의 기능을 살리고 코드를 깨끗하게 작성할 수 있게 되었다.
- 에러 처리를 위해 try ... catch 구문을 사용해야 한다.
- await 키워드를 사용하여 실행을 지연시킬 수 있다.