## 트랜잭션 (Transaction)

- DBMS에서 작업 수행의 단위
- 중간에 실행이 중단되는 경우 다시실행하는 rollback을 수행하고 오류없이 실행을 마치면 commit하는 실행 단위
- 트랜잭션의 목적은 데이터베이스의 완전성을 유지하기 위함이다.


### 1. ACID 원칙 - 트랜잭션의 특징

#### Atomicity (원자성)
- 트랜잭션의 작성 단위를 일부분만 실행하지 않는 것이다.
- 트랜잭션의 연산은 데이터베이스에 모두 반영되거나 전혀 반영되지 않아야한다.
- 수행하고 있는 트랜잭션에 의해 변경된 내열을 유지하면서 이전에 commit된 상태를 임시 영역(롤백 세그먼트)에 저장하여 보장한다.

#### Consistency (일관성)
- 트랜잭션이 성공적으로 완료되면 일관성있는 상태를 유지하는 것이다.
- 트랜잭션 수행 전/후에 외래키, 기본키, 도메인 제약조건 등을 만족하는 것을 통해 보장한다.

#### Isolation (독립성)
- 트랜잭션 수행 시 다른 트랜잭션이 끼어들지 못하도록 보전하는 것
- 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.
- 병행 처리를 통해 보장받는다.
- 병행처리는 트랜잭션에 정해진 시간을 할당해서 그 시간이 지나면 다른 트랜잭션을 실행하고 lock, unlock을통해 보장한다.
- 데이터를 읽고 쓸 때도 잠궈서 다른 트랜잭션이 접근하지 못하도록 하고, 수행이 끝나면 unlock을 통해 접근할 수 있도록 한다.
- shared_lock 상태를 다른 트랜잭션이 읽기 만을허용한 상태이고 exclusive_lock은 읽고 쓰지 못하도록한 상태이다.
- lock과 unlock을 잘못 사용하면 아무것도 하지 못하는 dead_lock 상태가 될 수 있다.

#### Durablility (지속성)
- 성공적으로 끝낸 트랜잭션을 영구적으로 반영하는 것

### 2. 트랜잭션의 연산

#### Commit
- 한 개의 트랜잭션에 대한 작업이 성공적으로 끝났고, 데이터베이스가 다시 일관된 상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 연산이다.

#### Rollback
- 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성이 깨진 경우, 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 역할이다.
- rollback 시에는 해당 트랜잭션을 재시작하거나 폐기한다.

### 3. 트랜잭션의 상태
- Active(활동) : 트랜잭션이 실행 중인 상태
- Failed(실패) : 트랜잭션 실행에 오류가 발생하여 중단된 상태
- Aborted(철회) : 트랜잭션이 비정상적으로 종료되어 rollback 연산을 수행한 상태
- Partially Committed(부분 완료) : 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
- Coomitted(완료) : 트랜잭션이 성공적으로 종료되어 commit 연산을 실행한 후의 상태


[참고](https://coding-factory.tistory.com/226)